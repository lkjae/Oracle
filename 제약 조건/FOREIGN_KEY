#다른 테이블과 관계 FOREGIN KEY

SELECT OWNER, CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINTS
WHERE TABLE_NAME IN ('EMP', 'DEPT');

DESC EMP;

#14-38 FOREIGN KEY가 참조하는 열에 존재하지 않는 데이터 입력하기
INSERT INTO EMP(EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (9999, '홍길동', 'CLERK', '7788', TO_DATE('2017/04/30', 'YYYY/MM/DD'), 1200, NULL, 50);

DELETE FROM EMP WHERE ENAME = '홍길동';
COMMIT;
SELECT * FROM EMP;

#14-39 DEPT_FK테이블 생성
CREATE TABLE DEPT_FK(
    DEPTNO  NUMBER(2) CONSTRAINT DEPTFK_DEPTNO_PK PRIMARY KEY,
    DNAME   VARCHAR2(14),
    LOC     VARCHAR(13)
);

DESC DEPT_FK;
DROP TABLE DEPT_FK;

CREATE TABLE EMP_FK(
    EMPNO  NUMBER(4) CONSTRAINT EMPFK_EMPNO_PK PRIMARY KEY,
    ENAME  VARCHAR2(10),
    JOB    VARCHAR2(9),
    MGR    NUMBER(4),
    HIREDATE DATE,
    SAL    NUMBER(7,2),
    COMM   NUMBER(7,2),
    DEPTNO NUMBER(2) CONSTRAINT EMPFK_DEPTNO_FK 
    REFERENCES DEPT_FK (DEPTNO) ON DELETE CASCADE
);

DESC EMP_FK;
DROP TABLE EMP_FK;
# 테이블을 만들 때 고유한 ID를 만들고 PRIMARY KEY로 사용
# DEPT_FK에 먼저 자료가 있어야 EMP_FK에서 레퍼런스로 받을 수 있다.

#14-42 DEPT_FK에 데이터 삽입하기
INSERT INTO DEPT_FK
VALUES(10, 'TEST_DNAME', 'TEST_LOC');

SELECT * FROM DEPT_FK;
SELECT * FROM EMP_FK;

#14-43 EMP_FK에 데이터 삽입하기
INSERT INTO EMP_FK
VALUES(9999, '홍길동', 'TEST_JOB', NULL, TO_DATE('2001/01/01', 'YYYY/MM/DD'),
       3000, NULL, 10);

DELETE FROM DEPT_FK
WHERE DEPTNO = 10; # ON DELETE CASCADE를 써주면 PRIMARY KEY 값을 삭제할 때 
		      관련된 데이터도 삭제된다.
		    # ON DELETE SET NULL을 써주면 DEPT_FK를 삭제하면 DEPTNO이 NULL이 되고 
                   	      데이터 나머지 데이터는 살아있다.

